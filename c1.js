// pr1
$(function(){function e(){var e=localStorage.getItem("tc1");return null==e&&(e=0),e}function t(){return localStorage.getItem("clc1")}function a(){return localStorage.getItem("vc1")}function o(){var e=localStorage.getItem("tc1");return null==e?(e=0,localStorage.setItem("tc1",e)):(e=Number(e-1),localStorage.setItem("tc1",e)),e}function c(){var e=localStorage.getItem("clc1");return null==e?(e=0,localStorage.setItem("clc1",e)):(e=Number(e-1),localStorage.setItem("clc1",e)),e}function n(){if($(".x-404-page").length<1&&1==window.candetect){var e=localStorage.getItem("usc1");if(1==window.sotc1&&"false"==e&&$(".search_popup").find(".form_here").length<1){localStorage.setItem("usc1","true"),$(".search_popup .x-header__search").remove();var t=$(".x-header__search").html();$(t).find("#search_form").removeAttr("id"),$(".search_popup .form_here").remove(),$(".search_popup").append("<div class='form_here'>"+t+"</div>"),$(".search_popup .x-search__header-overlay").remove(),$(".search_popup .x-search__page-overlay").remove(),$(".x-search__inner .x-search__autocomplete .x-autocomplete").remove(),$(".form_here .x-search__autocomplete").remove(""),$('.form_here [name="search_term"]').val(""),$('.x-search .x-search__field[name="search_term"]').blur(),$(".x-search").removeClass("x-search_state_active"),$(".x-search__page-overlay").css("background","transparent"),$(".x-product-main-terms .x-product-main-terms__col .x-pseudo-link+.x-overlay").hide(),$("[data-bazooka='GlobalShowPhones'] .x-overlay").addClass("x-hidden"),$(".x-product-sticky .x-product-sticky__col:nth-child(1) .x-overlay").addClass("x-hidden"),$(".x-product-info__variation .x-overlay").hide(),$(".qa-shoping-cart-list").closest(".x-overlay").hide(),$('.x-overlay__dialog_type_padded [data-qaid="success_msg_popup"]').closest(".x-overlay").addClass("x-hidden"),$(".x-company-info__parts .x-company-info__item .x-iconed-text .x-overlay").addClass("x-hidden"),$(".x-product-info .x-product-info__images .x-overlay").addClass("x-hidden"),$(".search_popup").css("display","block"),$(".search_overlay").css("display","block"),$("body").css("overflow","hidden"),$("html").css("overflow","hidden"),window.location.href.indexOf("prom.ua/ua")>-1?($(".search_popup .modal_title").text("Шукаете щось інше?"),$(".search_popup .sub_title").text("Ми допоможемо Вам знайти потрібний товар"),$(".search_popup .x-search__field").attr("placeholder","Почніть вводити назву товару")):($(".search_popup .modal_title").text("Ищете что-то другое?"),$(".search_popup .sub_title").text("Мы поможем Вам найти нужный товар"),$(".search_popup .x-search__field").attr("placeholder","Начните вводить название товара")),window.dataLayer=window.dataLayer||[],dataLayer.push({event:"gtm-ee-event-1"}),console.log("download_popup_event")}}}function r(){($(".x-product-info .js-product-buy-button.x-button_type_contour").length>0||$(".x-button_state_load").length>0)&&(window.sotc1=!1)}if(window.mvc1=1,window.sotc1=!0,window.candetect=!0,window.mmd=0,null==localStorage.getItem("usc1")&&localStorage.setItem("usc1","false"),$(".x-catalog .x-catalog__sidebar").length>0){document.addEventListener("mouseleave",function(a){var o=e(),c=(t(),localStorage.getItem("usc1"));0==o&&"false"==c&&1==window.candetect&&window.mmd>1&&(window.mmd=0,n(),localStorage.setItem("usc1","true"))});var l=localStorage.getItem("clc1");null==l&&(l=0),l<0&&(l=0),l++,localStorage.setItem("clc1",l),$(window).on("beforeunload",function(){c()})}if($.fn.visitThisPage=function(){var e=0;if($('[data-qaid="main_product_info"]').length>0){var t=$('[data-qaid="main_product_info"]').attr("data-rt-order-url"),a=t+"",o=a.match(/(product_id=[0-9]*)/g);e=0,o.length>0&&(o=o[0],o=o.replace("product_id=",""),e=localStorage.getItem("pvc1"+o)),null==e&&(e=0)}return e},$.fn.setVisitThisPage=function(e){var t=0;if($('[data-qaid="main_product_info"]').length>0){var a=$('[data-qaid="main_product_info"]').attr("data-rt-order-url"),o=a+"",c=o.match(/(product_id=[0-9]*)/g);c.length>0&&(c=c[0],c=c.replace("product_id=",""),t=localStorage.setItem("pvc1"+c,e))}return t},$(".x-product-page__details").length>0){var s=localStorage.getItem("vc1");null==s&&(s=0,localStorage.setItem("vc1",s));var d=localStorage.getItem("tc1");null==d&&(d=0),d<0&&(d=0),d++,localStorage.setItem("tc1",d),$(window).on("beforeunload",function(){o()}),document.addEventListener("mouseleave",function(o){var c=(e(),t(),a()),r=localStorage.getItem("usc1");visitThisPage=$.fn.visitThisPage(),c>window.mvc1&&"false"==r&&1==window.candetect&&window.mmd>1&&(window.mmd=0,n(),localStorage.setItem("usc1","true"))}),document.addEventListener("mousemove",function(e){if(0==$.fn.visitThisPage()&&1==window.candetect){var t=a();$.fn.setVisitThisPage(1),t++,localStorage.setItem("vc1",t)}})}document.addEventListener("mousemove",function(e){window.mmd++}),$(window).scroll(function(){window.candetect=!1,window.tm&&clearTimeout(window.tm),window.tm=setTimeout(function(){window.candetect=!0},150)}),document.onmousedown=function(e){1!=e.button&&2!=e.button||(window.candetect=!1,window.tm&&clearTimeout(window.tm),window.tm=setTimeout(function(){window.candetect=!0},150))},$("body").on("focus",".search_popup .form_here .x-search__field",function(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"gtm-ee-event-2"}),console.log("focus_popup_event")}),$("body").on("click",".search_popup .form_here .x-autocomplete__link",function(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"gtm-ee-event-3"}),console.log("search_item_event")}),$("body").on("click",".search_popup .form_here .x-search__button",function(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"gtm-ee-event-4"}),console.log("loop_btn_event")}),$("body").on("click",".search_popup .x-overlay__close-button",function(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"gtm-ee-event-5"}),console.log("close popup")}),$(".x-404-page").length<1&&($("body").on("keyup",".form_here [name='search_term']",function(){var e=$(this).val();window.typeint&&clearTimeout(window.typeint),window.typeint=setTimeout(function(e){var t=$(".form_here .x-search").attr("data-autocomplete-url");e.length>0&&$.ajax({url:t,type:"GET",dataType:"json",data:{term:e}}).done(function(t){$(".form_here .x-search__autocomplete").length<1&&$(".form_here .x-search").after('<div class="x-search__autocomplete"><div class="x-autocomplete"><ul class="autocomplete1 x-autocomplete__group" data-qaid="autocomplete_list"></ul><ul class="autocomplete2 x-autocomplete__group" data-qaid="autocomplete_list"></ul><ul class="autocomplete3 x-autocomplete__group" data-qaid="all_results_list"></ul></div></div>'),$(".form_here .x-autocomplete__group").html("");var a=5;$.each(t.results,function(t,o){o.name&&a>0&&($(".form_here .autocomplete1").append('<li class="x-autocomplete__item" data-qaid="suggest_item"><a class="x-autocomplete__link" href="https://prom.ua/search?search_term='+o.query+'" data-qaid="category_term_link"><span class="x-autocomplete__text"><b>'+e+'</b> в <span class="x-autocomplete__highlight-text">'+o.name+"</span></span></a></li>"),a--)});var o=5;$.each(t.results,function(e,t){"tag"==t.type&&o>0&&($(".form_here .autocomplete2").append('<li class="x-autocomplete__item" data-qaid="suggest_item"><a class="x-autocomplete__link" data-qaid="search_term_link" href="https://prom.ua/search?search_term='+t.query+'"><span class="x-autocomplete__counter-holder" data-qaid="term_hits_text">Найдено: &nbsp;<span class="x-autocomplete__counter">'+t.hits+'</span></span><span class="b-autocomplete__text" data-qaid="term_main_text"><b>'+t.query+"</b></span></a></li>"),o--)});var c=1;$.each(t.results,function(e,t){"search_term"==t.type&&c>0&&($(".form_here .autocomplete3").append('<li class="x-autocomplete__item" data-qaid="suggest_all_result"><a href="https://prom.ua/search?search_term='+t.query+'" class="x-autocomplete__link x-autocomplete__link_state_highlighted" data-qaid="suggest_link"><span class="x-autocomplete__text">Все результаты поиска</span></a></li>'),c--)})}).fail(function(){}).always(function(){})},500,e)}),console.log("desktop_var_c_1"),dataLayer.push({'event':'gtm-cro-event','gtm-cro-event-category':'EXP - Exit-Popup','gtm-cro-event-action':'Popup loaded'}),$(document).on('focus','.form_here [name="search_term"]',function(){dataLayer.push({'event':'gtm-cro-event','gtm-cro-event-category':'EXP - Exit-Popup','gtm-cro-event-action':'Focus search'});console.log('Focus search')}),$(document).on('click','.form_here [data-qaid="search_term_link"],.form_here [data-qaid="category_term_link"]',function(){dataLayer.push({'event':'gtm-cro-event','gtm-cro-event-category':'EXP - Exit-Popup','gtm-cro-event-action':'Click search results'});console.log('Click search results')}),$(document).on('click','.form_here [data-qaid="search_button"]',function(){dataLayer.push({'event':'gtm-cro-event','gtm-cro-event-category':'EXP - Exit-Popup','gtm-cro-event-action':'Click lens'})}),$("body").on("click",'[data-qaid="buy-button"]',function(e){window.sotc1=!1}),$("body").on("click",'[data-qaid="one-click-order-button"]',function(e){window.sotc1=!1}),window.tmr=setInterval(function(){$('[data-qaid="success_call_me_back_popup"]').length>0&&(localStorage.setItem("usc1","true"),window.sotc1=!1,clearInterval(window.tmr)),$('.x-overlay__dialog_type_padded [data-qaid="success_msg_popup"]').length>0&&0==$('.x-overlay__dialog_type_padded [data-qaid="success_msg_popup"] form').length&&(localStorage.setItem("usc1","true"),window.sotc1=!1,clearInterval(window.tmr)),$(".b-besida .b-besida__chat-item .b-besida__chat-msg").length>0&&(window.sotc1=!1,clearInterval(window.tmr))},100),r(),setInterval(function(){r()},100))});window.ccc = 0;window.addEventListener('contextmenu', function(e) {window.candetect=0;window.tm=setInterval(function(){window.candetect=false;window.ccc++;if(window.ccc ==1000){clearInterval(window.tm);window.candetect=true}},10)}, false);
// pr2
$(function() {
  if($('.x-404-page').length<1){
  $("body").on("click", ".search_popup .x-overlay__close-button", function(){
    $(".search_popup").css('display', 'none');
    $(".search_overlay").css('display', 'none');
    $(".x-search__page-overlay").remove();
    $("body").removeClass('h-layout-hidden');
      $("body").css('overflow', 'auto');
      $("html").css('overflow', 'auto');
  });
  $("body").on("click", ".x-pseudo-link", function(){
    $(this).closest('.x-product-main-terms__item').find('.x-overlay').show();
  });
  $("body").on("click", ".x-product-info__content .x-product-conversion .x-product-conversion__col>.x-product-conversion__iconed-text:first-child", function() {
    $("[data-bazooka='GlobalShowPhones'] .x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-company-info__parts .x-company-info__item .x-iconed-text", function(){
    $(this).closest(".x-company-info__item").find(".x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-product-info .x-product-info__images .x-product-info__blame-link", function(){
    $(this).closest(".x-product-info__images").find(".x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-product-sticky .x-product-sticky__col:nth-child(2) .x-product-sticky__item>div>div:nth-child(2)", function(){
    $("[data-bazooka='GlobalShowPhones'] .x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-product-sticky .x-product-sticky__col:nth-child(1) [data-bazooka='CompanyLocation']", function(){
    $(this).closest(".x-product-sticky__item").find(".x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-product-sticky .x-product-sticky__col:nth-child(1) [data-bazooka='CompanySchedule']", function(){
    $(this).closest(".x-product-sticky__item").find(".x-overlay").removeClass("x-hidden");
  });
  $("body").on("click", ".x-product-info__variation .x-drop-down__list .x-drop-down__list-item", function(){
    $(this).closest(".x-product-info__variation").find(".x-overlay").show();
  });
  $("body").on("click", ".x-product-info__variation .x-pseudo-link", function(){
    $(this).closest(".x-product-info__variation").find(".x-overlay").show();
  });
  $("body").on("click", ".x-header .js-shopping-cart-button-container", function(){
    $(".qa-shoping-cart-list").closest(".x-overlay").show();
  });
  $("body").on("click", ".x-product-conversion__item [data-qaid='order-payment-button']", function(){
    $('.x-overlay__dialog_type_padded [data-qaid="success_msg_popup"]').closest(".x-overlay").removeClass("x-hidden");
  });
  $("body").prepend('<div class="x-overlay search_overlay" style="z-index: 5000;"><div class="x-overlay__dialog x-cart-overlay search_popup" data-qaid="overlay"> <span class="x-overlay__close-button" data-qaid="close_btn">×</span><div class="x-empty-results"><div class="modal_title">Ищете что-то другое?</div> <p class="sub_title">Мы поможем Вам найти нужный товар</p></div></div>');
  $("<style type='text/css'>.search_overlay{display:none;overflow:hidden; z-index: 99999999 !important;}.search_popup{display:none;position: absolute;left: 0;right: 0;top: 0;bottom: 0;margin: auto;height: 143px;   max-width:475px;background-color:#f19b20;background-image:linear-gradient(-55deg,#772189 0%,#4853a2 100%);text-align:center;padding-top:21px;padding-bottom:49px}.search_popup .modal_title{color:#fff;font-size:32px;font-weight:400;margin-bottom:22px}.search_popup .x-overlay__close-button{color:#fff;right:7px;top:0px;opacity:0.2;cursor:pointer;z-index: 999;width: 30px;right: 0;}.search_popup .sub_title{color:#fff;font-size:19px;font-weight:400}.search_popup .x-empty-results{padding:0 0 15px}.search_popup .x-search{display:block;padding:0;max-width:370px;margin:0 auto;text-align:left;}.search_popup .x-search_state_active .x-search__inner{width:100%}.search_popup .x-search_state_active .x-search__holder{position:relative;top:0;right:0;left:0}.search_popup .form_here .x-search__autocomplete{top: auto;max-width: 368px;margin: 0 auto;text-align: left;}.search_popup .form_here .x-autocomplete__group{padding: 0;}.search_popup .form_here .x-autocomplete__item:first-child{padding-top: 10px;}, .search_popup .form_here .x-autocomplete__item:last-child{padding-bottom: 10px;}.x-one-click-order__btn[data-qaid='one-click-order-button']{pointer-events:auto}.x-one-click-order__btn.x-one-click-order__btn_state_disabled[data-qaid='one-click-order-button']{pointer-events:none}  .b-besida__btn.b-besida__btn_state_disabled{pointer-events:none}.b-besida__btn{pointer-events:auto}   .search_popup .form_here .x-autocomplete__link{position: relative;z-index: 999;padding: 10px 10px 10px 15px;}.search_overlay .search_popup .form_here .x-autocomplete{max-height: 300px;overflow-y: scroll;}.search_popup .x-autocomplete .autocomplete3 .x-autocomplete__item{padding: 0 !important;}@media screen and (max-height: 720px) {.search_overlay .search_popup .form_here .x-autocomplete{max-height: 200px;}}</style>").appendTo('head');
}
});